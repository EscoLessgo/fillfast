<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/svg+xml" href="/javascript.svg" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dots & Boxes (Discord)</title>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;700&display=swap" rel="stylesheet">
</head>

<body>
  <div id="background-anim"></div>
  <div id="app">
    <!-- DEBUG ERROR LOG -->
    <div id="debug-log"
      style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.85); color:#ff5555; z-index:2147483647; display:none; padding:20px; overflow:auto; font-family:monospace; font-size:14px; pointer-events:none; white-space: pre-wrap;">
    </div>
    <script>
      function logErr(msg) {
        var log = document.getElementById('debug-log');
        if (log) {
          log.style.display = 'block';
          log.innerHTML += '<div>' + msg + '</div><hr style="border-color:#555">';
        }
      }
      window.onerror = function (msg, url, lineNo, columnNo, error) {
        logErr('Runtime Error: ' + msg + '\n' + url + ':' + lineNo);
        return false;
      };
      window.onunhandledrejection = function (event) {
        logErr('Unhandled Promise: ' + event.reason);
      };
      window.addEventListener('error', function (e) {
        if (e.target && (e.target.tagName === 'IMG' || e.target.tagName === 'SCRIPT' || e.target.tagName === 'LINK')) {
          logErr('Resource Error (404/Block): ' + (e.target.src || e.target.href));
        }
      }, true);
      // Force visible if no content? 
      window.onload = function () {
        if (document.body.innerHTML.trim().length < 100) {
          logErr('Warning: Body appears empty.');
        }
      };
    </script>

    <!-- LOBBY SCREEN -->
    <div id="lobby-screen" class="screen">
      <div class="logo-large">
        <h1>DOTS & BOXES</h1>
      </div>

      <div class="lobby-controls">
        <div class="user-profile">
          <div id="my-avatar" class="avatar"></div>
          <span id="my-username">Loading...</span>
        </div>

        <button id="btn-create" class="btn-primary">CREATE ROOM</button>

        <div class="room-browser">
          <h3>AVAILABLE ROOMS</h3>
          <ul id="room-list">
            <li class="empty-msg">Scanning for games...</li>
          </ul>
        </div>

        <div class="legal-links" style="margin-top: 15px; font-size: 0.7em; text-align: center; opacity: 0.6;">
          <a href="/terms.html" target="_blank" style="color: #fff; margin: 0 5px;">Terms</a> |
          <a href="/privacy.html" target="_blank" style="color: #fff; margin: 0 5px;">Privacy</a>
        </div>
      </div>
    </div>

    <!-- WAITING SCREEN -->
    <div id="waiting-screen" class="screen hidden">
      <h2>ROOM: <span id="lobby-code-display">??????</span></h2>
      <div class="spinner"></div>
      <p class="status-msg">Waiting for opponent...</p>
    </div>

    <!-- GAME SCREEN -->
    <div id="game-screen" class="screen hidden">
      <div class="game-container">
        <div class="header">
          <div class="player-card" id="p1-card">
            <div class="avatar p1-avatar"></div>
            <div class="info">
              <span class="name" id="p1-name">P1</span>
              <span class="score" id="p1-score">0</span>
            </div>
          </div>

          <div class="vs-badge">VS</div>

          <div class="player-card" id="p2-card">
            <div class="info">
              <span class="name" id="p2-name">P2</span>
              <span class="score" id="p2-score">0</span>
            </div>
            <div class="avatar p2-avatar"></div>
          </div>
        </div>

        <div class="board-wrapper">
          <canvas id="gameCanvas"></canvas>

          <div id="result-overlay" class="overlay hidden">
            <h2 id="winner-text">GAME OVER</h2>
            <button id="btn-home">BACK TO LOBBY</button>
          </div>
        </div>

        <div class="footer">
          <span id="status-text">Initializing...</span>
        </div>
      </div>
    </div>

  </div>
  <script type="module" src="/src/main.js"></script>
</body>

</html>